generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Post {
  id          String   @id @default(cuid())
  name        String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdById String
  user        user     @relation(fields: [createdById], references: [id])

  @@index([name])
}

model account {
  id                    String    @id @default(cuid())
  accountId             String
  providerId            String
  userId                String
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  user                  user      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model affiliate {
  id             String     @id @default(cuid())
  userId         String     @unique
  referralCode   String     @unique
  commissionRate Decimal    @db.Decimal(5, 4)
  totalEarned    Decimal    @default(0) @db.Decimal(10, 2)
  isActive       Boolean    @default(true)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
  user           user       @relation(fields: [userId], references: [id], onDelete: Cascade)
  referral       referral[]

  @@index([isActive])
  @@index([referralCode])
}

model character {
  id                              String           @id @default(cuid())
  name                            String
  posterId                        String?
  videoId                         String?
  gender                          CharacterGender
  style                           CharacterStyle
  ethnicity                       Ethnicity
  age                             Int
  hairStyle                       HairStyle
  hairColor                       HairColor
  eyeColor                        EyeColor
  bodyType                        BodyType
  breastSize                      BreastSize
  personality                     Personality
  relationship                    Relationship
  occupation                      Occupation
  voice                           String
  isPublic                        Boolean          @default(false)
  isActive                        Boolean          @default(true)
  isLive                          Boolean          @default(false)
  createdAt                       DateTime         @default(now())
  updatedAt                       DateTime         @updatedAt
  createdById                     String
  user                            user             @relation(fields: [createdById], references: [id], onDelete: Cascade)
  poster                          media?           @relation("character_posterIdTomedia", fields: [posterId], references: [id])
  video                           media?           @relation("character_videoIdTomedia", fields: [videoId], references: [id])
  character_kink                  character_kink[]
  chat                            chat[]
  reel                            reel[]
  story                           story[]

  @@index([createdById])
  @@index([gender])
  @@index([isActive])
  @@index([isPublic])
  @@index([personality])
  @@index([style])
}

model character_kink {
  id          String    @id @default(cuid())
  characterId String
  kink        Kink
  createdAt   DateTime  @default(now())
  character   character @relation(fields: [characterId], references: [id], onDelete: Cascade)

  @@unique([characterId, kink])
  @@index([characterId])
  @@index([kink])
}

model chat {
  id                String              @id @default(cuid())
  userId            String
  characterId       String
  isArchived        Boolean             @default(false)
  lastMessageAt     DateTime?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  character         character           @relation(fields: [characterId], references: [id], onDelete: Cascade)
  user              user                @relation(fields: [userId], references: [id], onDelete: Cascade)
  message           message[]
  message_embedding message_embedding[]

  @@unique([userId, characterId])
  @@index([characterId])
  @@index([isArchived])
  @@index([lastMessageAt])
  @@index([userId])
}

model collection {
  id        String   @id @default(cuid())
  userId    String
  messageId String?  @unique
  mediaId   String
  createdAt DateTime @default(now())
  media     media    @relation(fields: [mediaId], references: [id], onDelete: Cascade)
  message   message? @relation(fields: [messageId], references: [id])
  user      user     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([mediaId])
  @@index([userId])
}

model media {
  id                                  String       @id @default(cuid())
  type                                MediaType
  key                                 String       @unique
  url                                 String
  mimeType                            String?
  size                                Int?
  width                               Int?
  height                              Int?
  duration                            Int?
  createdAt                           DateTime     @default(now())
  character_character_posterIdTomedia character[]  @relation("character_posterIdTomedia")
  character_character_videoIdTomedia  character[]  @relation("character_videoIdTomedia")
  collection                          collection[]
  reel_reel_thumbnailIdTomedia        reel[]       @relation("reel_thumbnailIdTomedia")
  reel_reel_videoIdTomedia            reel[]       @relation("reel_videoIdTomedia")
  story_story_mediaIdTomedia          story[]      @relation("story_mediaIdTomedia")
  story_story_thumbnailIdTomedia      story[]      @relation("story_thumbnailIdTomedia")

  @@index([createdAt])
  @@index([type])
}

model message {
  id                String             @id @default(cuid())
  chatId            String
  type              MessageType
  content           String
  isFromUser        Boolean
  isDeleted         Boolean            @default(false)
  createdAt         DateTime           @default(now())
  collection        collection?
  chat              chat               @relation(fields: [chatId], references: [id], onDelete: Cascade)
  message_embedding message_embedding?

  @@index([chatId])
  @@index([createdAt])
  @@index([isFromUser])
}

model message_embedding {
  id        String                   @id @default(dbgenerated("gen_random_uuid()::text"))
  messageId String                   @unique @map("message_id")
  chatId    String                   @map("chat_id")
  embedding Unsupported("vector")?
  createdAt DateTime                 @default(now()) @map("created_at")
  message   message                  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  chat      chat                     @relation(fields: [chatId], references: [id], onDelete: Cascade)

  @@index([chatId])
}

model reel {
  id          String    @id @default(cuid())
  characterId String
  videoId     String
  thumbnailId String?
  title       String?
  description String?
  viewCount   Int       @default(0)
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  character   character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  thumbnail   media?    @relation("reel_thumbnailIdTomedia", fields: [thumbnailId], references: [id])
  video       media     @relation("reel_videoIdTomedia", fields: [videoId], references: [id], onDelete: Cascade)

  @@index([characterId])
  @@index([createdAt])
  @@index([isActive])
  @@index([videoId])
}

model referral {
  id             String         @id @default(cuid())
  affiliateId    String
  referredUserId String         @unique
  status         ReferralStatus @default(pending)
  commission     Decimal        @default(0) @db.Decimal(10, 2)
  convertedAt    DateTime?
  paidAt         DateTime?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  affiliate      affiliate      @relation(fields: [affiliateId], references: [id], onDelete: Cascade)
  user           user           @relation(fields: [referredUserId], references: [id], onDelete: Cascade)

  @@index([affiliateId])
  @@index([status])
}

model session {
  id        String   @id @default(cuid())
  expiresAt DateTime
  token     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      user     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model story {
  id          String    @id @default(cuid())
  characterId String
  mediaId     String
  thumbnailId String?
  expiresAt   DateTime
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  character   character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  media       media     @relation("story_mediaIdTomedia", fields: [mediaId], references: [id], onDelete: Cascade)
  thumbnail   media?    @relation("story_thumbnailIdTomedia", fields: [thumbnailId], references: [id])

  @@index([characterId])
  @@index([expiresAt])
  @@index([isActive])
  @@index([mediaId])
}

model subscription {
  id                 String             @id @default(cuid())
  userId             String             @unique
  billingCycle       BillingCycle
  status             SubscriptionStatus
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  coinGateOrderId    String?
  cancelledAt        DateTime?
  createdAt          DateTime           @default(now())
  updatedAt          DateTime           @updatedAt
  user               user               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([coinGateOrderId])
  @@index([currentPeriodEnd])
  @@index([status])
}

model usage_quota {
  id              String   @id @default(cuid())
  userId          String
  periodStart     DateTime
  periodEnd       DateTime
  tokensUsed      Int      @default(0)
  tokensLimit     Int
  messagesUsed    Int      @default(0)
  imagesGenerated Int      @default(0)
  videosGenerated Int      @default(0)
  audiosGenerated Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  user            user     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, periodStart, periodEnd])
  @@index([periodEnd])
  @@index([userId])
}

model user {
  id            String        @id @default(cuid())
  name          String
  email         String        @unique
  emailVerified Boolean       @default(false)
  image         String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @default(now()) @updatedAt
  avatar        String?
  nickname      String?
  gender        String?
  language      Language      @default(english)
  notifications Boolean       @default(true)
  role          UserRole      @default(default)
  Post          Post[]
  account       account[]
  affiliate     affiliate?
  character     character[]
  chat          chat[]
  collection    collection[]
  referral      referral?
  session       session[]
  subscription  subscription?
  usage_quota   usage_quota[]

  @@index([language])
  @@index([role])
}

model verification {
  id         String   @id @default(cuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt
}

enum BillingCycle {
  monthly
  quarterly
  annually
}

enum BodyType {
  skinny
  athletic
  average
  curvy
  bbw
}

enum BreastSize {
  small
  medium
  large
  extra_large
}

enum CharacterGender {
  girl
  men
  trans
}

enum CharacterStyle {
  realistic
  anime
}

enum Ethnicity {
  caucasian
  asian
  black
  latina
  arab
}

enum EyeColor {
  brown
  blue
  green
  red
  yellow
}

enum HairColor {
  brunette
  blonde
  black
  redhead
  pink
  blue
  purple
  white
  multicolor
}

enum HairStyle {
  straight
  bangs
  curly
  bun
  short
  ponytail
}

enum Kink {
  daddy_dominance
  bondage
  spanking
  collar_leash
  punishment
  humiliation
  public_play
  roleplay
  anal_play
  oral_play
  cum_play
  creampie
  squirting
  dirty_talk
  breeding
  edging
  obedience
  control
  inexperienced
  shy_flirting
  playful_teasing
  cuddling
  slow_sensual
  hair_pulling
}

enum Language {
  english
  german
  french
  spanish
}

enum MediaType {
  image
  video
}

enum MessageType {
  text
  image
  video
  audio
}

enum Occupation {
  student
  dancer
  model
  stripper
  maid
  cam_girl
  boss
  babysitter
  pornstar
  streamer
  bartender
  tech_engineer
  lifeguard
  cashier
  massage_therapist
  teacher
  nurse
  secretary
  yoga_instructor
  fitness_coach
}

enum Personality {
  nympho
  lover
  submissive
  dominant
  temptress
  innocent
  caregiver
  experimenter
  mean
  confidant
  shy
  queen
}

enum ReferralStatus {
  pending
  converted
  paid
}

enum Relationship {
  stranger
  girlfriend
  sex_friend
  school_mate
  work_colleague
  wife
  mistress
  friend
  step_sister
  step_mom
  step_daughter
  landlord
  sugar_baby
  boss
  teacher
  student
  neighbour
  mother_in_law
  sister_in_law
}

enum SubscriptionStatus {
  active
  cancelled
  expired
  pending
}

enum UserRole {
  default
  admin
  superadmin
}
